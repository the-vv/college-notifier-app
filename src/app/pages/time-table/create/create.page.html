<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button slot="start"></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-menu-button slot="end"></ion-menu-button>
    </ion-buttons>
    <ion-title>{{'timeTable' | string}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card>
    <ion-accordion-group [value]="accordianVal" (ionChange)="accChange($event)">
      <ion-accordion value="colors" value="settings">
        <ion-item slot="header">
          <ion-label>{{'timeTable' | string}} {{'settings' | string}}</ion-label>
        </ion-item>
        <ion-list slot="content" class="m-0 p-0">
          <ion-grid>
            <ion-row>
              <ion-col size="12" size-md="6">
                <ion-item id="open-date-input-1">
                  <ion-label position="fixed">{{'startDate' | string}}</ion-label>
                  <ion-input [value]="dateRange.start | date"></ion-input>
                  <ion-popover trigger="open-date-input-1" show-backdrop="false" [alignment]="'center'" side="top">
                    <ng-template>
                      <ion-datetime [min]="minDate" [showDefaultButtons]="true" #popoverDatetime1
                        [value]="dateRange.start" presentation="date"
                        (ionChange)="setStartDate(popoverDatetime1.value)"></ion-datetime>
                    </ng-template>
                  </ion-popover>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-md="6">
                <ion-item id="open-date-input-2">
                  <ion-label position="fixed">{{'endDate' | string}}</ion-label>
                  <ion-input [value]="dateRange.end | date"></ion-input>
                  <ion-popover trigger="open-date-input-2" show-backdrop="false" [alignment]="'center'" side="top">
                    <ng-template>
                      <ion-datetime [min]="minDate" [showDefaultButtons]="true" #popoverDatetime2
                        [value]="dateRange.end" presentation="date" (ionChange)="setEndDate(popoverDatetime2.value)">
                      </ion-datetime>
                    </ng-template>
                  </ion-popover>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="floating">{{'department' | string}}</ion-label>
                  <ionic-selectable #portComponent [formControl]="departmentControl" [items]="availableDpts"
                    itemValueField="_id" itemTextField="name" [isMultiple]="false" [canSearch]="true"
                    closeButtonSlot="end" [shouldFocusSearchbar]="true" [shouldStoreItemValue]="false">
                    <ng-template ionicSelectableTitleTemplate>
                      {{'choose' | string}} {{'department' | string}}
                    </ng-template>
                    <ng-template ionicSelectableValueTemplate let-port="value">
                      {{departmentControl.value?.name}}
                    </ng-template>
                  </ionic-selectable>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="floating">{{'active' | string}} {{'classes' | string}}</ion-label>
                  <ionic-selectable #portComponent [formControl]="classesControl" [items]="availableClasses"
                    itemValueField="_id" itemTextField="nameLong" [isMultiple]="true" [canSearch]="true"
                    closeButtonSlot="end" [shouldFocusSearchbar]="true" [shouldStoreItemValue]="false">
                    <ng-template ionicSelectableTitleTemplate>
                      {{'choose' | string}} {{'classes' | string}}
                    </ng-template>
                    <ng-template ionicSelectableValueTemplate let-port="value">
                      {{classesControl.value?.length}} {{'selected' | string}}
                    </ng-template>
                  </ionic-selectable>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-md="4">
                <ion-item>
                  <ion-label position="floating">{{'hoursCount' | string}}</ion-label>
                  <ion-input type="number" [formControl]="hoursCtrl"></ion-input>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-md="8">
                <ion-item>
                  <ion-label position="floating">{{'customRole' | string}}</ion-label>
                  <ion-select #cRolesSelect interface="popover" [multiple]="true" [formControl]="rolesCtrl">
                    <ion-select-option *ngFor="let crole of customRoles" [value]="crole.value">{{crole.name | string}}
                    </ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-center">
              <ion-col size="12" sizeMd="6" class="text-center mt-1">
                <ion-button (click)="onStart()" fill="outline"> {{'start' | string}} {{'creating' | string}}
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-list>
      </ion-accordion>
    </ion-accordion-group>
  </ion-card>

  <ion-card *ngIf="showGrid">
    <ion-accordion-group [value]="tutorAccordian" (ionChange)="tutorAcccChange($event)">
      <ion-accordion value="colors" value="tutor">
        <ion-item slot="header">
          <ion-label>{{'available' | string}} {{'tutors' | string}}</ion-label>
        </ion-item>
        <ion-list slot="content" class="m-0 p-0  tutor-container">
          <ion-grid>
            <ion-row>
              <ion-col *ngFor="let t of allTutorList; let i = index;" size="12" size-md="4">
                <ion-item>
                  <ion-icon name="pause-outline" class="handles" slot="end"></ion-icon>
                  <ion-avatar slot="start">
                    <img [src]="t.image || 'assets/images/avatar.png'" />
                  </ion-avatar>
                  <ion-label>
                    <h2>{{t.name}}</h2>
                    <p>{{t.role}}</p>
                  </ion-label>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-list>
      </ion-accordion>
    </ion-accordion-group>
  </ion-card>

  <ion-card *ngIf="showGrid">
    <p-table [value]="getRangeArray(finalHoursCount)" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th [width]="'30px'">{{'hour' | string}}</th>
          <th *ngFor="let allocation of allocationData">{{'class' | string}} {{allocation.class['name']}}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-hour>
        <tr>
          <td><span class="p-column-title">{{'hour' | string}}</span>{{hour + 1}}</td>
          <td class="droppers" *ngFor="let allocation of allocationData">
            <div class="drop-column"><span class="valign">{{allocation.class['name']}} {{'hour' | string}} {{hour + 1}}</span></div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ion-card>

</ion-content>